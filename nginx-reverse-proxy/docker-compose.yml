version: '2'

services:

  nginx-reverse-proxy:
    image: nginx
    container_name: nginx-reverse-proxy
    volumes:
     - ./default.conf:/etc/nginx/conf.d/default.conf
    ports:
     - 80:80
    links:
     - transmission
     - media-nginx
     - gitlab

  transmission:
    image: linuxserver/transmission
    container_name: transmission
    volumes:
      - /home/arcadas/.config/transmission:/config
      - /media/nas/torrent:/downloads
    expose:
      - 9091
      - 51413

  media-nginx:
    image: nginx
    container_name: media-nginx
    expose:
      - 80
    volumes:
      - /home/arcadas/github/dts2ac3-webgui:/www/media
      - /home/arcadas/github/arcadas-server/media/nginx/default.conf:/etc/nginx/conf.d/default.conf
    links:
      - media-php

  media-php:
    image: php-fpm-mkv
    container_name: media-php
    expose:
      - 9000
    volumes:
      - /home/arcadas/github/dts2ac3-webgui:/www/media
      - /media/nas/movies:/media/nas/movies

  gitlab:
    image: gitlab/gitlab-ce:latest
    container_name: gitlab
    restart: always
    hostname: gitlab.arcadas.com
    environment:
      GITLAB_OMNIBUS_CONFIG: |
        external_url 'http://gitlab.arcadas.com'
        # Add any other gitlab.rb configuration here, each on its own line
    expose:
      - 80
      - 443
      - 22
    volumes:
      - /srv/gitlab/config:/etc/gitlab
      - /srv/gitlab/logs:/var/log/gitlab
      - /srv/gitlab/data:/var/opt/gitlab
